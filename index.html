<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulário Técnico WKVE</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --azul-escuro: #001a33;
      --azul-medio: #003366;
      --degrade-fundo: linear-gradient(135deg, var(--azul-escuro) 0%, var(--azul-medio) 100%);
      --cinza-escuro: #333333;
      --cinza-medio: #666666;
      --branco: #ffffff;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--degrade-fundo);
      padding: 20px;
      margin: 0;
      color: var(--cinza-escuro);
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 20px auto;
      background: var(--branco);
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0, 20, 40, 0.3);
      border-radius: 10px;
      border-top: 5px solid var(--azul-medio);
    }

    h1 {
      text-align: center;
      font-size: 24px;
      margin-bottom: 25px;
      color: var(--azul-escuro);
      padding-bottom: 10px;
      border-bottom: 2px solid var(--azul-medio);
      text-transform: uppercase;
    }

    label {
      font-weight: 600;
      display: block;
      margin-top: 18px;
      color: var(--azul-escuro);
      font-size: 15px;
      text-transform: uppercase;
    }

    .label-info {
      font-weight: normal;
      font-size: 12px;
      color: var(--cinza-medio);
      text-transform: none;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      box-sizing: border-box;
      font-size: 15px;
      border: 1px solid var(--cinza-medio);
      border-radius: 6px;
      transition: all 0.3s;
    }

    input.uppercase {
      text-transform: uppercase;
    }

    input.numeric {
      text-transform: none;
    }

    #senha, #observacao {
      text-transform: none;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 25px;
      flex-wrap: wrap;
    }

    button {
      flex: 1;
      min-width: 120px;
      padding: 12px;
      font-size: 15px;
      cursor: pointer;
      color: white;
      border: none;
      border-radius: 6px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-transform: uppercase;
      font-weight: bold;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    button:nth-child(1) {
      background: var(--azul-escuro);
    }

    button:nth-child(2) {
      background: var(--azul-medio);
    }

    button:nth-child(3) {
      background: #0056b3;
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }

    button:active {
      transform: translateY(1px);
    }

    #resultado {
      white-space: pre-wrap;
      background: rgba(248, 249, 250, 0.9);
      padding: 20px;
      margin-top: 30px;
      border: 1px solid var(--cinza-medio);
      border-radius: 8px;
      font-size: 15px;
      line-height: 1.6;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
    }

    .hidden {
      display: none;
    }

    .location-buttons {
      display: flex;
      gap: 10px;
      margin-top: 5px;
    }

    .location-buttons button {
      padding: 8px 12px;
      font-size: 14px;
    }

    #mapLink {
      color: var(--azul-medio);
      text-decoration: none;
      font-size: 14px;
      display: block;
      margin-top: 5px;
    }

    .error {
      border-color: #ff0000 !important;
    }

    .error-message {
      color: #ff0000;
      font-size: 12px;
      margin-top: 5px;
      display: none;
    }

    @media (max-width: 600px) {
      .button-group, .location-buttons {
        flex-direction: column;
      }
      
      body {
        padding: 10px;
      }
      
      .container {
        padding: 15px;
        margin: 10px auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Formulário de Atendimento Técnico - WKVE</h1>

    <label for="atividade">Tipo de Atividade</label>
    <select id="atividade" required onchange="mostrarCampoRecolhido()">
      <option value="">Selecione</option>
      <option value="ATIVAÇÃO">ATIVAÇÃO</option>
      <option value="REPARO">REPARO</option>
      <option value="REPARO + TROCA DE ONU">REPARO + TROCA DE ONU</option>
      <option value="MUDANÇA DE ENDEREÇO">MUDANÇA DE ENDEREÇO</option>
      <option value="MUDANÇA DE ENDEREÇO + TROCA DE ONU">MUDANÇA DE ENDEREÇO + TROCA DE ONU</option>
    </select>

    <label for="nome">Nome do Cliente</label>
    <input type="text" id="nome" class="uppercase" placeholder="Digite o nome completo" pattern="[A-Za-zÀ-ú\s]+" title="Somente letras são permitidas">
    <div class="error-message" id="nome-error">Somente letras são permitidas</div>

    <label for="os">Nº da OS</label>
    <input type="text" id="os" class="numeric" placeholder="Número da ordem de serviço" pattern="\d{6}" title="Digite exatamente 6 dígitos numéricos">
    <div class="error-message" id="os-error">Digite exatamente 6 dígitos</div>

    <label for="isp">ISP / ID</label>
    <input type="text" id="isp" class="numeric" placeholder="Identificação do ISP" pattern="\d{6}" title="Digite exatamente 6 dígitos numéricos">
    <div class="error-message" id="isp-error">Digite exatamente 6 dígitos</div>

    <label for="plano">Plano</label>
    <input type="text" id="plano" class="numeric" placeholder="Plano contratado" pattern="\d+" title="Somente números são permitidos">
    <div class="error-message" id="plano-error">Somente números são permitidos</div>

    <label for="pon">PON</label>
    <input type="text" id="pon" class="uppercase" placeholder="Ultimos 4 digitos">

    <label for="onu">ONU</label>
    <input type="text" id="onu" class="uppercase" placeholder="Modelo da ONU">

    <label for="sinal">Sinal</label>
    <input type="number" id="sinal" class="numeric" placeholder="Valor do sinal dBm" step="0.01">

    <label for="wifi">Nome da Rede (Wi-Fi)</label>
    <input type="text" id="wifi" class="uppercase" placeholder="WKVE-" value="WKVE-" oninput="formatarWifi()">
    <div class="error-message" id="wifi-error">O nome deve começar com WKVE-</div>

    <label for="senha">Senha do Wi-Fi</label>
    <input type="text" id="senha" placeholder="Senha da rede Wi-Fi" minlength="8" maxlength="16">
    <div class="error-message" id="senha-error">A senha deve ter entre 8 e 16 caracteres</div>

    <label for="olt">OLT</label>
    <select id="olt">
      <option value="">Selecione</option>
      <option value="OLT1">OLT 1 - CENTRO</option>
      <option value="OLT2">OLT 2 - ZONA NORTE</option>
      <option value="OLT3">OLT 3 - ZONA SUL</option>
      <option value="OLT4">OLT 4 - ZONA LESTE</option>
      <option value="OLT5">OLT 5 - ZONA OESTE</option>
    </select>

    <label for="cto">CTO</label>
    <span class="label-info">Informações sobre contagem de porta: <a href="https://devgpon.wkve.net.br/tecnico/manual_cto.pdf" target="_blank">Manual CTO</a></span>
    <input type="text" id="cto" class="uppercase" placeholder="Nome da CTO" autocomplete="off">

    <label for="localizacaoCTO">Localização da CTO</label>
    <div class="location-buttons">
      <button onclick="getLocation()"><i class="fas fa-map-marker-alt"></i> Obter Localização</button>
      <button onclick="copyLocation()"><i class="fas fa-copy"></i> Copiar Coordenadas</button>
    </div>
    <input type="text" id="localizacaoCTO" placeholder="Coordenadas aparecerão aqui" readonly>
    <a id="mapLink" href="#" target="_blank" style="display:none;"><i class="fas fa-map-marked-alt"></i> Ver no Mapa</a>

    <label for="porta">Porta</label>
    <select id="porta">
      <option value="">Selecione</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
      <option value="11">11</option>
      <option value="12">12</option>
      <option value="13">13</option>
      <option value="14">14</option>
      <option value="15">15</option>
      <option value="16">16</option>
    </select>

    <label for="endereco">Endereço</label>
    <textarea id="endereco" class="uppercase" placeholder="Endereço completo do cliente"></textarea>

    <label for="tecnico">Técnico Responsável</label>
    <input type="text" id="tecnico" class="uppercase" placeholder="Seu nome">

    <label for="material">Materiais Utilizados</label>
    <textarea id="material" class="uppercase" placeholder="Liste os materiais utilizados"></textarea>

    <div id="recolhidoContainer" class="hidden">
      <label for="materialRecolhido">Material Recolhido</label>
      <textarea id="materialRecolhido" class="uppercase" placeholder="Liste os materiais recolhidos"></textarea>
    </div>

    <label for="observacao">Observações</label>
    <textarea id="observacao" placeholder="Adicione observações relevantes"></textarea>

    <div class="button-group">
      <button onclick="gerarScript()">
        <i class="fas fa-code"></i> Gerar Script
      </button>
      <button onclick="copiarScript()">
        <i class="far fa-copy"></i> Copiar
      </button>
      <button onclick="enviarWhatsApp()">
        <i class="fab fa-whatsapp"></i> WhatsApp
      </button>
    </div>

    <div id="resultado"></div>
  </div>

 <script>
    // Funções para restringir entrada de caracteres (funciona em mobile e desktop)
    function setupInputRestrictions() {
      // Campo que aceita apenas letras
      const nomeInput = document.getElementById('nome');
      nomeInput.addEventListener('input', function() {
        this.value = this.value.replace(/[^A-Za-zÀ-Úà-ú\s]/g, '');
        validateLettersOnly(this, 'nome-error');
      });
      
      // Campos que aceitam apenas números com limite de caracteres
      const numericInputs = {
        'os': 6,
        'isp': 6,
        'plano': null // Sem limite de caracteres
      };
      
      Object.keys(numericInputs).forEach(id => {
        const input = document.getElementById(id);
        const maxLength = numericInputs[id];
        
        input.addEventListener('input', function() {
          // Remove tudo que não for número
          this.value = this.value.replace(/\D/g, '');
          
          // Aplica limite de caracteres se especificado
          if (maxLength && this.value.length > maxLength) {
            this.value = this.value.slice(0, maxLength);
          }
          
          // Validação específica para cada campo
          if (id === 'os' || id === 'isp') {
            validateNumericLength(this, id + '-error', maxLength);
          } else {
            validateNumbersOnly(this, id + '-error');
          }
        });
      });
    }

    // Chamar a função quando o DOM estiver carregado
    document.addEventListener('DOMContentLoaded', function() {
      setupInputRestrictions();
      
      // Configurar outras validações
      document.getElementById('senha').addEventListener('input', function() {
        validatePassword(this, 'senha-error');
      });

      document.getElementById('wifi').addEventListener('input', function() {
        validateWifi(this, 'wifi-error');
      });
    });

    // Funções de validação
    function validateLettersOnly(input, errorId) {
      const errorElement = document.getElementById(errorId);
      if (/[^A-Za-zÀ-ú\s]/.test(input.value)) {
        input.classList.add('error');
        errorElement.style.display = 'block';
      } else {
        input.classList.remove('error');
        errorElement.style.display = 'none';
      }
    }

    function validateNumericLength(input, errorId, length) {
      const errorElement = document.getElementById(errorId);
      if (!/^\d*$/.test(input.value) || (length && input.value.length > length)) {
        input.classList.add('error');
        errorElement.style.display = 'block';
      } else {
        input.classList.remove('error');
        errorElement.style.display = 'none';
      }
    }

    function validateNumbersOnly(input, errorId) {
      const errorElement = document.getElementById(errorId);
      if (!/^\d*$/.test(input.value)) {
        input.classList.add('error');
        errorElement.style.display = 'block';
      } else {
        input.classList.remove('error');
        errorElement.style.display = 'none';
      }
    }

    function validatePassword(input, errorId) {
      const errorElement = document.getElementById(errorId);
      if (input.value.length < 8 || input.value.length > 16) {
        input.classList.add('error');
        errorElement.style.display = 'block';
      } else {
        input.classList.remove('error');
        errorElement.style.display = 'none';
      }
    }

    function validateWifi(input, errorId) {
      const errorElement = document.getElementById(errorId);
      if (!input.value.startsWith('WKVE-')) {
        input.classList.add('error');
        errorElement.style.display = 'block';
      } else {
        input.classList.remove('error');
        errorElement.style.display = 'none';
      }
    }

    function formatarWifi() {
      const wifiInput = document.getElementById('wifi');
      if (!wifiInput.value.startsWith('WKVE-')) {
        wifiInput.value = 'WKVE-' + wifiInput.value.replace('WKVE-', '');
      }
      wifiInput.value = wifiInput.value.toUpperCase();
    }

    // Garante que o sinal sempre seja negativo
    document.getElementById('sinal').addEventListener('input', function() {
      let value = this.value;
      if (value && !value.startsWith('-')) {
        value = value.replace(/^-/, '');
        if (value !== '') {
          this.value = '-' + value;
        }
      }
    });

    // Mostrar/ocultar campo de material recolhido
    function mostrarCampoRecolhido() {
      const atividade = document.getElementById("atividade").value;
      const container = document.getElementById("recolhidoContainer");
      const atividadesComRecolhimento = ["REPARO + TROCA DE ONU", "MUDANÇA DE ENDEREÇO + TROCA DE ONU"];
      
      container.classList.toggle("hidden", !atividadesComRecolhimento.includes(atividade));
      if (container.classList.contains("hidden")) {
        document.getElementById("materialRecolhido").value = "";
      }
    }

    // Geolocalização automática
    function getLocation() {
      const locationInput = document.getElementById("localizacaoCTO");
      const mapLink = document.getElementById("mapLink");
      
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const lat = position.coords.latitude.toFixed(6);
            const lng = position.coords.longitude.toFixed(6);
            locationInput.value = `${lat}, ${lng}`;
            mapLink.href = `https://www.google.com/maps?q=${lat},${lng}`;
            mapLink.style.display = "inline-block";
          },
          (error) => {
            alert("Erro ao obter localização: " + error.message);
          },
          { enableHighAccuracy: true, timeout: 10000 }
        );
      } else {
        alert("Geolocalização não suportada neste navegador.");
      }
    }

    // Copiar coordenadas
    function copyLocation() {
      const coords = document.getElementById("localizacaoCTO").value;
      if (coords) {
        navigator.clipboard.writeText(coords);
        alert("Coordenadas copiadas!");
      } else {
        alert("Nenhuma localização disponível para copiar.");
      }
    }

    // Formatar para WhatsApp (sem emojis)
    function formatarParaWhatsApp() {
      const get = id => document.getElementById(id).value.trim();
      const timestamp = new Date().toLocaleString('pt-BR');

      // Verificar campos obrigatórios
      if (!validarCampos()) {
        return false;
      }

      let mensagem = "*RELATÓRIO TÉCNICO WKVE*\n\n";
      
      // Informações básicas
      mensagem += `*ATIVIDADE:* ${get("atividade")}\n`;
      mensagem += `*CLIENTE:* ${get("nome")}\n`;
      mensagem += `*OS Nº:* ${get("os")}\n`;
      mensagem += `*ISP/ID:* ${get("isp")}\n`;
      mensagem += `*PLANO:* ${get("plano")}\n`;
      mensagem += `*PON:* ${get("pon")}\n`;
      mensagem += `*ONU:* ${get("onu")}\n`;
      mensagem += `*SINAL:* ${get("sinal")}\n`;
      mensagem += `*WI-FI:* ${get("wifi")}\n`;
      mensagem += `*SENHA:* ${get("senha")}\n`;
      mensagem += `*OLT:* ${get("olt")}\n`;
      mensagem += `*CTO:* ${get("cto")}\n`;
      mensagem += `*LOCALIZAÇÃO CTO:* ${get("localizacaoCTO")}\n`;
      mensagem += `*LINK MAPA:* ${document.getElementById("mapLink").href}\n`;
      mensagem += `*PORTA:* ${get("porta")}\n`;
      mensagem += `*ENDEREÇO:* ${get("endereco")}\n`;
      mensagem += `*TÉCNICO:* ${get("tecnico")}\n\n`;
      
      // Materiais
      mensagem += `*MATERIAIS UTILIZADOS:*\n${get("material")}\n\n`;
      
      // Material recolhido (se aplicável)
      if (!document.getElementById("recolhidoContainer").classList.contains("hidden")) {
        mensagem += `*MATERIAL RECOLHIDO:*\n${get("materialRecolhido")}\n\n`;
      }
      
      // Observações
      mensagem += `*OBSERVAÇÕES:*\n${get("observacao")}\n\n`;
      mensagem += `*DATA/HORA:* ${timestamp}`;

      return mensagem;
    }

    function validarCampos() {
      let isValid = true;
      
      // Verificar cada campo obrigatório
      const requiredFields = [
        'atividade', 'nome', 'os', 'isp', 'plano', 'wifi', 'senha',
        'olt', 'cto', 'porta', 'endereco', 'tecnico'
      ];
      
      requiredFields.forEach(field => {
        const element = document.getElementById(field);
        if (!element.value.trim()) {
          element.classList.add('error');
          isValid = false;
        } else {
          element.classList.remove('error');
        }
      });
      
      // Verificar WiFi
      if (!document.getElementById('wifi').value.startsWith('WKVE-')) {
        document.getElementById('wifi').classList.add('error');
        document.getElementById('wifi-error').style.display = 'block';
        isValid = false;
      }
      
      // Verificar senha
      if (document.getElementById('senha').value.length < 8 || 
          document.getElementById('senha').value.length > 16) {
        document.getElementById('senha').classList.add('error');
        document.getElementById('senha-error').style.display = 'block';
        isValid = false;
      }
      
      if (!isValid) {
        alert("Preencha todos os campos obrigatórios corretamente!");
        return false;
      }
      
      return true;
    }

    // Gerar visualização
    function gerarScript() {
      const mensagem = formatarParaWhatsApp();
      if (mensagem) {
        document.getElementById("resultado").innerText = mensagem;
      }
    }

    // Copiar texto
    function copiarScript() {
      const mensagem = formatarParaWhatsApp();
      if (mensagem) {
        navigator.clipboard.writeText(mensagem)
          .then(() => {
            const btn = document.querySelector('button[onclick="copiarScript()"]');
            btn.innerHTML = '<i class="fas fa-check"></i> Copiado!';
            setTimeout(() => {
              btn.innerHTML = '<i class="far fa-copy"></i> Copiar';
            }, 2000);
          });
      }
    }

    // Enviar por WhatsApp
    function enviarWhatsApp() {
      const mensagem = formatarParaWhatsApp();
      if (mensagem) {
        const textoCodificado = encodeURIComponent(mensagem);
        window.open(`https://wa.me/?text=${textoCodificado}`, '_blank');
      }
    }
</script>
</body>
</html>
